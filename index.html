<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ù…Ø­Ø³Ù† Ø¬Ø¯Ø§Ù‹</title>
    <style>
        /* Reset and Basic Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Ø®Ø· Ø£ÙØ¶Ù„ */
        }

        :root {
            --primary-color: rgba(255, 0, 0, 0.8);
            --primary-color-light: rgba(255, 0, 0, 0.6);
            --primary-color-dark: rgba(200, 0, 0, 1);
            --bg-color: #000;
            --text-color: #fff;
            --container-bg: rgba(0, 0, 0, 0.8);
            --input-bg: rgba(255, 255, 255, 0.1);
            --input-border: rgba(255, 0, 0, 0.3);
            --hover-bg: rgba(255, 0, 0, 0.3);
            --shadow-color: rgba(255, 0, 0, 0.3);
            --disabled-color: #888;
        }

        body {
            min-height: 100vh;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            overflow-x: hidden;
            position: relative;
            padding: 20px;
            color: var(--text-color);
        }

        /* Animated Background (unchanged) */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.1);
            animation: float 12s infinite ease-in-out; /* ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· */
        }
        @keyframes float {
            0%, 100% { transform: translateY(110vh) scale(0.5); opacity: 0; }
            50% { opacity: 0.5; }
            75% { transform: translateY(-50vh) scale(1); opacity: 0.2; }
        }

        /* Main Container */
        .main-container {
            position: relative;
            width: 100%;
            max-width: 1300px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            min-height: 100vh;
            display: flex;
            flex-direction: row; /* ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ ØµÙ */
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            flex-wrap: wrap; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù„ØªÙØ§Ù */
        }

        /* Player Area */
        .player-area {
            flex: 3; /* ÙŠØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± */
            min-width: 400px; /* Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ */
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Playlist Area */
        .playlist-area {
            flex: 1; /* ÙŠØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø© Ø£Ù‚Ù„ */
            min-width: 300px; /* Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ */
            max-height: 80vh; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø£Ù‚ØµÙ‰ */
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: sticky; /* ØªØ«Ø¨ÙŠØª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            top: 20px;
        }

        /* Player Container */
        .player-container {
            width: 100%;
            background: var(--container-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 25px var(--shadow-color);
            backdrop-filter: blur(8px);
        }

        /* Search Container */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        #videoUrl {
            flex: 1;
            padding: 12px 15px;
            font-size: 16px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        #videoUrl:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--shadow-color);
        }
        .add-btn {
            padding: 12px 15px;
            background: var(--primary-color-light);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        .add-btn:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }

        /* Video Wrapper */
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #111;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        #videoPlayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Controls Container */
        .controls-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 10px;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            position: relative;
        }
        .progress-bar-filled {
            height: 100%;
            width: 0%;
            background: var(--primary-color);
            border-radius: 4px;
            transition: width 0.1s linear; /* Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ù„Ø³ */
        }
        .progress-bar-buffered {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 4px;
            z-index: -1; /* Ø®Ù„Ù Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
            transition: width 0.2s linear;
        }
         .progress-bar-thumb { /* Ù†Ù‚Ø·Ø© ØµØºÙŠØ±Ø© Ø¹Ù†Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ø±ÙŠØ· */
            position: absolute;
            top: 50%;
            right: 0; /* ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¨Ø³Ø¨Ø¨ dir=rtl */
            width: 14px;
            height: 14px;
            background: var(--primary-color);
            border-radius: 50%;
            transform: translate(50%, -50%); /* Ø¶Ø¨Ø· Ø§Ù„Ù…ÙˆØ¶Ø¹ */
            opacity: 0; /* Ù…Ø®ÙÙŠ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            transition: opacity 0.2s ease;
            pointer-events: none; /* Ù„Ø§ ÙŠØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø± */
        }
        .progress-bar-container:hover .progress-bar-thumb {
            opacity: 1; /* ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
        }


        /* Main Controls */
        .main-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù„ØªÙØ§Ù ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s ease, transform 0.2s ease;
            line-height: 1; /* Ù„Ù…Ù†Ø¹ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
        }
        .control-button:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }
        .control-button:disabled {
            color: var(--disabled-color);
            cursor: not-allowed;
            transform: none;
        }
         .control-button.active { /* Ù„Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ */
             color: var(--primary-color);
         }

        /* Time Display */
        .time-display {
            font-size: 14px;
            min-width: 100px; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø´ÙƒÙ„ Ø«Ø§Ø¨Øª */
            text-align: center;
        }

        /* Volume Control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #volumeSlider {
            width: 80px;
            height: 5px;
            cursor: pointer;
            appearance: none;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            transition: background 0.2s ease;
        }
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù€ Webkit (Chrome, Safari) */
        #volumeSlider::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù€ Firefox */
        #volumeSlider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        .volume-control:hover #volumeSlider { /* ÙŠÙ…ÙƒÙ† Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª */
            /* display: inline-block; */
        }

        /* Playback Speed Control */
        #speedSelector {
            background: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--input-border);
            border-radius: 5px;
            padding: 3px 5px;
            font-size: 13px;
            cursor: pointer;
            outline: none;
        }
        #speedSelector option {
            background: #333;
            color: var(--text-color);
        }

        /* Playlist Container */
        .playlist-container {
            width: 100%;
            background: var(--container-bg);
            border-radius: 10px;
            padding: 10px;
            max-height: calc(80vh - 50px); /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ø±ØªÙØ§Ø¹ playlist-area */
            overflow-y: auto;
            box-shadow: 0 0 15px var(--shadow-color);
            backdrop-filter: blur(5px);
        }

        /* Playlist Item */
        .playlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--input-bg);
            border-radius: 5px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 3px solid transparent; /* Ø­Ø¯ Ø¬Ø§Ù†Ø¨ÙŠ Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø´Ø· */
        }
        .playlist-item:hover {
            background: var(--hover-bg);
        }
        .playlist-item.playing {
            background: var(--primary-color-light);
            border-right-color: var(--primary-color); /* ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø´ØºÙ„ */
        }
        .playlist-item-title {
            flex: 1;
            color: var(--text-color);
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-left: 10px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
        }
        .playlist-item-actions {
            display: flex;
            gap: 5px;
        }
        .playlist-item-actions button {
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .playlist-item-actions button:hover {
            background: var(--primary-color);
        }

        /* Notification (unchanged) */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            box-shadow: 0 0 10px var(--shadow-color);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
            font-size: 15px;
        }
        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px); /* Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ */
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }
            .player-area, .playlist-area {
                width: 100%;
                max-width: 800px; /* Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
                flex: none; /* Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ²ÙŠØ¹ flex */
                position: static; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª */
                max-height: none; /* Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
            }
            .playlist-area {
                margin-top: 20px; /* Ù…Ø³Ø§ÙØ© Ø¥Ø¶Ø§ÙÙŠØ© */
            }
            .playlist-container {
                 max-height: 300px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£ØµØºØ± */
            }
        }

        @media (max-width: 480px) {
            .player-container, .playlist-container {
                padding: 10px;
            }
            #videoUrl { padding: 10px 12px; font-size: 14px; }
            .add-btn { padding: 10px 12px; font-size: 18px; }
            .control-button { font-size: 18px; }
            .time-display { font-size: 12px; min-width: 80px; }
            #volumeSlider { width: 60px; }
            .playlist-item-title { font-size: 13px; }
            .playlist-item-actions button { font-size: 11px; padding: 3px 6px; }
            .main-controls { justify-content: center; } /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ */
        }

        /* Spinner for loading indicator */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10; /* ÙÙˆÙ‚ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§ */
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .video-wrapper.loading .loader {
            display: block;
        }

    </style>
</head>
<body>
    <div class="animated-background" id="animatedBg"></div>
    <div id="notification" class="notification"></div>

    <div class="main-container">
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØºÙ„ -->
        <div class="player-area">
            <div class="player-container">
                <div class="search-container">
                    <input type="text"
                           id="videoUrl"
                           placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ù…Ø¹Ø±Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§..."
                           autocomplete="off">
                    <button class="add-btn" id="addToPlaylist" title="Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØªØ´ØºÙŠÙ„ (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ©)">+</button>
                </div>

                <div class="video-wrapper" id="videoWrapper">
                    <div class="loader" id="videoLoader"></div>
                    <div id="videoPlayer"></div> <!-- ØªØºÙŠÙŠØ± Ù…Ù† iframe Ø¥Ù„Ù‰ div -->
                </div>

                <div class="controls-container">
                    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
                    <div class="progress-bar-container" id="progressBarContainer">
                        <div class="progress-bar-buffered" id="progressBarBuffered"></div>
                        <div class="progress-bar-filled" id="progressBarFilled"></div>
                        <div class="progress-bar-thumb" id="progressBarThumb"></div>
                    </div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                    <div class="main-controls">
                        <div class="control-group">
                            <button class="control-button" id="prevBtn" title="Ø§Ù„Ø³Ø§Ø¨Ù‚ (Shift+P)">â®</button>
                            <button class="control-button" id="playPauseBtn" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù (Space/K)">â–¶</button>
                            <button class="control-button" id="nextBtn" title="Ø§Ù„ØªØ§Ù„ÙŠ (Shift+N)">â­</button>
                        </div>

                        <div class="control-group volume-control">
                            <button class="control-button" id="muteBtn" title="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… (M)">ğŸ”Š</button>
                            <input type="range" id="volumeSlider" min="0" max="100" value="100" title="Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª">
                        </div>

                        <div class="time-display" id="timeDisplay">00:00 / 00:00</div>

                        <div class="control-group">
                             <select id="speedSelector" title="Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ´ØºÙŠÙ„">
                                <option value="0.25">0.25x</option>
                                <option value="0.5">0.5x</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="1.75">1.75x</option>
                                <option value="2">2x</option>
                            </select>
                            <button class="control-button" id="repeatBtn" title="ØªÙƒØ±Ø§Ø± (R)">ğŸ”</button> <!-- Modes: off, all, one -->
                            <button class="control-button" id="shuffleBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (S)">ğŸ”€</button>
                            <button class="control-button" id="fullscreenBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© (F)">â›¶</button>
                            <!-- Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹) -->
                             <!-- <button class="control-button" id="pipBtn" title="ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ ØµÙˆØ±Ø© (I)">â</button> -->
                             <!-- <button class="control-button" id="skipBackwardBtn" title="Ø±Ø¬ÙˆØ¹ 10 Ø«ÙˆØ§Ù† (J)">â†ºÂ¹â°</button> -->
                             <!-- <button class="control-button" id="skipForwardBtn" title="ØªÙ‚Ø¯ÙŠÙ… 10 Ø«ÙˆØ§Ù† (L)">Â¹â°â†»</button> -->
                        </div>
                    </div>
                </div>
            </div>
             <!-- ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£Ù‚Ø³Ø§Ù… Ø£Ø®Ø±Ù‰ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ø«Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (ÙˆÙ‡Ù…ÙŠØ©)ØŒ Ø¥Ù„Ø® -->
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ -->
        <div class="playlist-area">
             <h3 style="text-align: center; margin-bottom: 5px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</h3>
             <div class="playlist-container" id="playlist">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                <p id="emptyPlaylistMsg" style="text-align: center; color: #aaa; padding: 20px;">Ø£Ø¶Ù Ø±ÙˆØ§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡!</p>
             </div>
        </div>
    </div>

    <script>
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© (unchanged)
        function createBubbles() { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ } // (Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠØŒ Ø£Ø¨Ù‚ÙŠØªÙ‡ Ù…Ø®ØªØµØ±Ø§Ù‹ Ù‡Ù†Ø§)
        createBubbles(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø©

        // -------------------------------------------------------------
        //  YouTube IFrame Player API & Global Variables
        // -------------------------------------------------------------
        let player; // Ø³ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒØ§Ø¦Ù† Ù…Ø´ØºÙ„ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
        let playlist = [];
        let originalPlaylistOrder = []; // Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        let currentVideoIndex = -1;
        let isPlayerReady = false;
        let progressUpdateInterval; // Ù„ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        let lastSavedPosition = {}; // Ù„ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± Ù…ÙˆØ¶Ø¹ Ù„ÙƒÙ„ ÙÙŠØ¯ÙŠÙˆ {videoId: time}

        // States
        let repeatMode = 'off'; // 'off', 'all', 'one'
        let isShuffleOn = false;
        let currentVolume = 100;
        let isMuted = false;
        let currentSpeed = 1;

        const REPEAT_MODES = ['off', 'all', 'one'];
        const REPEAT_ICONS = {'off': 'ğŸ”', 'all': 'ğŸ”Â¹', 'one': 'ğŸ”‚'}; // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„Ù„ØªÙƒØ±Ø§Ø±

        // DOM Elements
        const videoUrlInput = document.getElementById('videoUrl');
        const addToPlaylistBtn = document.getElementById('addToPlaylist');
        const videoWrapper = document.getElementById('videoWrapper');
        const videoLoader = document.getElementById('videoLoader');
        const playlistContainer = document.getElementById('playlist');
        const emptyPlaylistMsg = document.getElementById('emptyPlaylistMsg');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBarFilled = document.getElementById('progressBarFilled');
        const progressBarBuffered = document.getElementById('progressBarBuffered');
        const progressBarThumb = document.getElementById('progressBarThumb');
        const timeDisplay = document.getElementById('timeDisplay');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const muteBtn = document.getElementById('muteBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const repeatBtn = document.getElementById('repeatBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const speedSelector = document.getElementById('speedSelector');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const notification = document.getElementById('notification');


        // -------------------------------------------------------------
        //  YouTube IFrame API Setup
        // -------------------------------------------------------------

        // 1. ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© YouTube API Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            console.log("YouTube IFrame API script requested.");
        }

        // 2. Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø³ØªÙØ³ØªØ¯Ø¹Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ API
        function onYouTubeIframeAPIReady() {
            console.log("YouTube IFrame API Ready.");
            isPlayerReady = false; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
            // Ù„Ø§ Ù†Ù†Ø´Ø¦ Ø§Ù„Ù…Ø´ØºÙ„ Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ù†Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
             loadAppState(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© API
             initializePlayer(); // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ø¢Ù†
        }

        // 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´ØºÙ„ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
        function initializePlayer(videoId = null) {
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø´ØºÙ„ Ù‚Ø¯ÙŠÙ…
             if (player && typeof player.destroy === 'function') {
                try {
                    player.destroy();
                    console.log("Previous player instance destroyed.");
                } catch (e) {
                    console.error("Error destroying previous player:", e);
                }
                player = null; // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¥Ù„Ù‰ null
            }

             console.log(`Initializing player${videoId ? ' with videoId: ' + videoId : ''}...`);
             // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‡Ø¯Ù
            if (!document.getElementById('videoPlayer')) {
                console.error("Player container div (#videoPlayer) not found!");
                return;
            }

             try {
                player = new YT.Player('videoPlayer', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId, // ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† null ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    playerVars: {
                        'playsinline': 1,       // Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ iOS
                        'autoplay': 0,          // Ù„Ù† Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‡Ù†Ø§ØŒ Ù†ØªØ­ÙƒÙ… Ø¨Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                        'controls': 0,          // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                        'rel': 0,               // Ø¹Ø¯Ù… Ø¹Ø±Ø¶ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø°Ø§Øª ØµÙ„Ø©
                        'modestbranding': 1,    // ØªÙ‚Ù„ÙŠÙ„ Ø´Ø¹Ø§Ø± ÙŠÙˆØªÙŠÙˆØ¨
                        'iv_load_policy': 3,    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
                        'fs': 0                 // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù†Ø³ØªØ®Ø¯Ù… Ø²Ø±Ù†Ø§ Ø§Ù„Ø®Ø§Øµ)
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError,
                        // 'onPlaybackQualityChange': onPlayerPlaybackQualityChange, // Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¨Ø¯ÙˆÙ† API
                        'onPlaybackRateChange': onPlayerPlaybackRateChange
                    }
                });
                console.log("YT.Player object created.");
            } catch (error) {
                console.error("Error creating YT.Player:", error);
                showNotification(`Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„: ${error.message}`);
            }
        }

        // 4. Ø¹Ù†Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…Ø´ØºÙ„
        function onPlayerReady(event) {
            console.log("Player Ready:", event.target);
            isPlayerReady = true;
            videoWrapper.classList.remove('loading');
            applyInitialSettings(); // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ø§Ù„ØµÙˆØªØŒ Ø§Ù„Ø³Ø±Ø¹Ø©)
            startProgressUpdater(); // Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…

            // Ø§Ø³ØªØ¦Ù†Ø§Ù Ù…Ù† Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡
            const currentVideo = playlist[currentVideoIndex];
            if (currentVideo && lastSavedPosition[currentVideo.id]) {
                 const resumeTime = parseFloat(lastSavedPosition[currentVideo.id]);
                 // Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ø£ÙƒØ¨Ø± Ù…Ù† Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù† (Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
                 if (resumeTime > 3 && resumeTime < player.getDuration() - 5) {
                    player.seekTo(resumeTime, true);
                    console.log(`Resuming video ${currentVideo.id} at ${formatTime(resumeTime)}`);
                    showNotification(`ØªÙ… Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù Ù…Ù† ${formatTime(resumeTime)}`);
                 }
            }
            // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            updatePlayPauseButton();
            updateVolumeUI();
            updateSpeedSelector();
            updateNavButtons();
        }

        // 5. Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ØºÙ„ (ØªØ´ØºÙŠÙ„ØŒ Ø¥ÙŠÙ‚Ø§ÙØŒ Ø§Ù†ØªÙ‡Ø§Ø¡ØŒ ...)
        function onPlayerStateChange(event) {
            console.log("Player State Changed:", event.data, stateToString(event.data));
            updatePlayPauseButton(); // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            saveCurrentPosition(); // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø£Ùˆ Ø§Ù„ØªØºÙŠÙŠØ±

            if (event.data === YT.PlayerState.ENDED) {
                handleVideoEnd();
            } else if (event.data === YT.PlayerState.PLAYING) {
                 videoWrapper.classList.remove('loading');
                 startProgressUpdater();
                 updatePlaylistHighlight(); // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø´ØºÙ„
            } else if (event.data === YT.PlayerState.PAUSED) {
                stopProgressUpdater();
            } else if (event.data === YT.PlayerState.BUFFERING) {
                 videoWrapper.classList.add('loading');
                stopProgressUpdater(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            } else if (event.data === YT.PlayerState.CUED) {
                videoWrapper.classList.remove('loading');
                // Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„
            }
             updateNavButtons(); // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        }

        // 6. Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´ØºÙ„
        function onPlayerError(event) {
            videoWrapper.classList.remove('loading');
            stopProgressUpdater();
            console.error("Player Error:", event.data);
            let errorMsg = `Ø­Ø¯Ø« Ø®Ø·Ø£ (${event.data})`;
            switch (event.data) {
                case 2: errorMsg = 'Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­ (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø¹Ø±Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø®Ø§Ø·Ø¦).'; break;
                case 5: errorMsg = 'Ø®Ø·Ø£ ÙÙŠ Ù…Ø´ØºÙ„ HTML5.'; break;
                case 100: errorMsg = 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ø®Ø§Øµ.'; break;
                case 101: case 150: errorMsg = 'ØµØ§Ø­Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨ØªØ´ØºÙŠÙ„Ù‡ ÙÙŠ Ù…Ø´ØºÙ„Ø§Øª Ù…Ø¶Ù…Ù†Ø©.'; break;
            }
            showNotification(errorMsg);
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            // setTimeout(playNext, 3000);
        }

        // 7. Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù„Ù„ØªØ£ÙƒÙŠØ¯ ÙÙ‚Ø·ØŒ Ù†Ø­Ù† Ù†ØªØ­ÙƒÙ… Ø¨Ù‡Ø§)
        function onPlayerPlaybackRateChange(event) {
            console.log("Playback Rate Changed (by player):", event.data);
            currentSpeed = event.data;
            speedSelector.value = currentSpeed;
             saveAppState(); // Ø­ÙØ¸ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù†Øµ Ù…ÙÙ‡ÙˆÙ…
        function stateToString(state) {
            switch (state) {
                case -1: return 'UNSTARTED';
                case YT.PlayerState.ENDED: return 'ENDED';
                case YT.PlayerState.PLAYING: return 'PLAYING';
                case YT.PlayerState.PAUSED: return 'PAUSED';
                case YT.PlayerState.BUFFERING: return 'BUFFERING';
                case YT.PlayerState.CUED: return 'CUED';
                default: return 'UNKNOWN';
            }
        }

        // -------------------------------------------------------------
        //  Playlist Management
        // -------------------------------------------------------------

        function loadPlaylist() {
            const savedPlaylist = localStorage.getItem('youtubePlaylist');
            if (savedPlaylist) {
                playlist = JSON.parse(savedPlaylist);
                originalPlaylistOrder = [...playlist]; // Ù†Ø³Ø® Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ
                console.log("Playlist loaded from localStorage:", playlist.length, "items");
            } else {
                playlist = [];
                originalPlaylistOrder = [];
                console.log("No saved playlist found.");
            }
             renderPlaylist(); // Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø­ØªÙ‰ Ù„Ùˆ ÙØ§Ø±ØºØ©)
        }

        function savePlaylist() {
            localStorage.setItem('youtubePlaylist', JSON.stringify(playlist));
            console.log("Playlist saved to localStorage.");
            // Ù„Ø§ Ù†Ø­ÙØ¸ originalPlaylistOrder Ù‡Ù†Ø§ØŒ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        }

        function renderPlaylist() {
            playlistContainer.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

            if (playlist.length === 0) {
                playlistContainer.appendChild(emptyPlaylistMsg);
                emptyPlaylistMsg.style.display = 'block';
                updateNavButtons(); // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©
                return;
            }

            emptyPlaylistMsg.style.display = 'none';

            const displayList = isShuffleOn ? getShuffledIndices().map(i => playlist[i]) : playlist;
            const displayIndices = isShuffleOn ? getShuffledIndices() : playlist.map((_, i) => i); // ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ø¹Ø±Ø¶

            displayList.forEach((item, displayIndex) => {
                const originalIndex = isShuffleOn ? displayIndices[displayIndex] : displayIndex; // Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ playlist
                const playlistItem = document.createElement('div');
                playlistItem.className = 'playlist-item';
                playlistItem.dataset.originalIndex = originalIndex; // ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø£ØµÙ„ÙŠ
                if (originalIndex === currentVideoIndex) {
                    playlistItem.classList.add('playing');
                }

                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø±Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ¹Ù†ÙˆØ§Ù† Ù…Ø¤Ù‚Øª
                const title = item.title || `ÙÙŠØ¯ÙŠÙˆ ${item.id.substring(0, 6)}...`;

                playlistItem.innerHTML = `
                    <div class="playlist-item-title" title="${item.url}\n${title}">${title}</div>
                    <div class="playlist-item-actions">
                        <button class="play-btn" data-original-index="${originalIndex}" title="ØªØ´ØºÙŠÙ„">â–¶</button>
                        <button class="delete-btn" data-original-index="${originalIndex}" title="Ø­Ø°Ù">ğŸ—‘</button>
                    </div>
                `;

                // Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ù†ÙØ³Ù‡ Ù„ØªØ´ØºÙŠÙ„Ù‡
                playlistItem.querySelector('.playlist-item-title').addEventListener('click', () => {
                    playVideo(originalIndex);
                });

                playlistContainer.appendChild(playlistItem);
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§
            document.querySelectorAll('.play-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ØµÙ„ÙŠ
                    const index = parseInt(this.getAttribute('data-original-index'));
                    playVideo(index);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ØµÙ„ÙŠ
                    const index = parseInt(this.getAttribute('data-original-index'));
                    removeFromPlaylist(index);
                });
            });

            updateNavButtons(); // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        }

        function extractVideoId(url) {
            // (Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ)
             const patterns = [
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/,
                /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([^?]+)/,
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([^?]+)/,
                 /([a-zA-Z0-9_-]{11})/ // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø£ÙŠ ØªØ³Ù„Ø³Ù„ ÙŠØ´Ø¨Ù‡ Ù…Ø¹Ø±Ù ÙÙŠØ¯ÙŠÙˆ
            ];
             url = url.trim(); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡

            for (let pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1] && match[1].length === 11) { // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø±Ù
                     // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø­Ø±Ù ØºÙŠØ± ØµØ§Ù„Ø­Ø© (ØªØ²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ù‚Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹)
                     if (/^[a-zA-Z0-9_-]+$/.test(match[1])) {
                         return match[1];
                     }
                }
            }
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø·ØŒ Ø§ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù‡Ùˆ Ø§Ù„Ù…Ø¹Ø±Ù Ù†ÙØ³Ù‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„Ù‡ 11
            if (url.length === 11 && /^[a-zA-Z0-9_-]+$/.test(url)) {
                 return url;
            }
            return null;
        }

        // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¯ÙˆÙ† API
        function getVideoTitlePlaceholder(videoId) {
            return `ÙÙŠØ¯ÙŠÙˆ ${videoId}`; // Ø¹Ù†ÙˆØ§Ù† Ù…Ø¤Ù‚Øª Ø¨Ø³ÙŠØ·
        }

        async function addToPlaylist(url) {
            const videoId = extractVideoId(url);
            if (videoId) {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
                if (playlist.some(item => item.id === videoId)) {
                    showNotification('Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.');
                    videoUrlInput.value = ''; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
                    videoUrlInput.focus();
                    return;
                }

                const title = getVideoTitlePlaceholder(videoId); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†ÙˆØ§Ù† Ù…Ø¤Ù‚Øª
                const newItem = {
                    id: videoId,
                    title: title,
                    url: url.includes('http') ? url : `https://www.youtube.com/watch?v=${videoId}` // ØªØ®Ø²ÙŠÙ† Ø±Ø§Ø¨Ø· ØªÙ‚Ø±ÙŠØ¨ÙŠ
                };

                playlist.push(newItem);
                originalPlaylistOrder.push(newItem); // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ Ø£ÙŠØ¶Ø§Ù‹
                savePlaylist();
                renderPlaylist();
                showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„');

                 // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØºÙ„ Ø­Ø§Ù„ÙŠØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                 if (!player || currentVideoIndex === -1) {
                     const newIndex = playlist.length - 1;
                     playVideo(newIndex);
                 } else if (player && player.getPlayerState && player.getPlayerState() === YT.PlayerState.ENDED) {
                      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø´ØºÙ„ Ù‚Ø¯ Ø§Ù†ØªÙ‡Ù‰ Ù„ØªÙˆÙ‡ØŒ Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                      const newIndex = playlist.length - 1;
                      playVideo(newIndex);
                 }


                videoUrlInput.value = ''; // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            } else {
                showNotification('Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù…Ø¹Ø±Ù ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± ØµØ§Ù„Ø­');
            }
        }

        function removeFromPlaylist(indexToRemove) {
            if (indexToRemove < 0 || indexToRemove >= playlist.length) {
                console.error("Invalid index to remove:", indexToRemove);
                return;
            }

            const removedItem = playlist[indexToRemove];
            console.log("Removing video at index:", indexToRemove, "ID:", removedItem.id);

            // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ
            playlist.splice(indexToRemove, 1);
            originalPlaylistOrder = originalPlaylistOrder.filter(item => item.id !== removedItem.id); // Ø¥Ø²Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø±Ù

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (playlist.length === 0) {
                // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ø§Ù„Ø¢Ù†
                currentVideoIndex = -1;
                if (player && typeof player.stopVideo === 'function') {
                    player.stopVideo(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                    player.clearVideo ? player.clearVideo() : player.cueVideoById(''); // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø³Ø­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                }
                 updateUIForNoVideo(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙÙŠØ¯ÙŠÙˆ
            } else {
                 // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø´ØºÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹
                if (indexToRemove === currentVideoIndex) {
                     // Ø­Ø§ÙˆÙ„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ§Ù„ÙŠ (Ø£Ùˆ Ø§Ù„Ø£ÙˆÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­Ø°ÙˆÙ Ù‡Ùˆ Ø§Ù„Ø£Ø®ÙŠØ±)
                     // Ù†Ø³ØªØ®Ø¯Ù… indexToRemove Ù„Ø£Ù†Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°ÙØŒ Ù‡Ø°Ø§ Ø§Ù„ÙÙ‡Ø±Ø³ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ
                    let nextIndex = indexToRemove % playlist.length;
                    playVideo(nextIndex); // Ø³ØªÙ‚ÙˆÙ… playVideo Ø¨ØªØ­Ø¯ÙŠØ« currentVideoIndex
                } else if (indexToRemove < currentVideoIndex) {
                    // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø¹Ù†ØµØ± Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ÙŠØ¬Ø¨ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    currentVideoIndex--;
                }
                // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù„Ø§ ÙŠØªØºÙŠØ± currentVideoIndex
            }

            savePlaylist();
            saveAppState(); // Ø­ÙØ¸ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            renderPlaylist();
             // Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†Ø´Ø·Ù‹Ø§
             if (isShuffleOn) {
                applyShuffle(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                renderPlaylist(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
             }
            showNotification('ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„');
        }

        function updateUIForNoVideo() {
            timeDisplay.textContent = "00:00 / 00:00";
            progressBarFilled.style.width = '0%';
            progressBarBuffered.style.width = '0%';
            progressBarThumb.style.opacity = '0';
             playPauseBtn.textContent = 'â–¶';
             playPauseBtn.title = 'ØªØ´ØºÙŠÙ„';
             // Ù‚Ø¯ ØªØ±ØºØ¨ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‡Ù†Ø§
             updateNavButtons();
        }

        // -------------------------------------------------------------
        //  Video Playback Control
        // -------------------------------------------------------------

        function playVideo(index) {
            if (!playlist || index < 0 || index >= playlist.length) {
                console.error("Invalid index or empty playlist:", index);
                showNotification("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.");
                 if (playlist.length === 0) updateUIForNoVideo();
                return;
            }

            const video = playlist[index];
            console.log(`Attempting to play video at index ${index}: ID = ${video.id}`);

            currentVideoIndex = index;
            saveAppState(); // Ø­ÙØ¸ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ

            if (!player || !isPlayerReady) {
                 console.log("Player not ready or not initialized. Initializing with video:", video.id);
                 // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´ØºÙ„ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡ Ù…Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ÙˆÙ„
                 initializePlayer(video.id);
                 // Ø³ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© onPlayerReady Ø¥Ø°Ø§ Ø£Ø¶ÙÙ†Ø§ Ù…Ù†Ø·Ù‚Ù‹Ø§ Ù„Ø°Ù„ÙƒØŒ
                 // Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù‡Ù†Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
                 setTimeout(() => {
                     if (player && typeof player.playVideo === 'function') {
                         console.log("Retrying playVideo after initialization delay.");
                         player.playVideo();
                          videoWrapper.classList.add('loading'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                     }
                 }, 1000); // ØªØ£Ø®ÙŠØ± Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„
            } else {
                 console.log("Player exists. Loading video:", video.id);
                 videoWrapper.classList.add('loading'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                 player.loadVideoById(video.id);
                 // Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø³Ø¨Ø¨ onPlayerStateChange Ø£Ùˆ onReady
                 // ÙŠÙ…ÙƒÙ† Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ù€ player.playVideo() Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                  // player.playVideo(); // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø¶Ø±ÙˆØ±ÙŠØ§Ù‹ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹
            }

            renderPlaylist(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¸Ù„ÙŠÙ„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
             updateNavButtons(); // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
             resetProgress(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        }

         function resetProgress() {
            progressBarFilled.style.width = '0%';
            progressBarBuffered.style.width = '0%';
            progressBarThumb.style.opacity = '0';
            timeDisplay.textContent = "00:00 / 00:00";
             if (progressUpdateInterval) {
                 clearInterval(progressUpdateInterval);
                 progressUpdateInterval = null;
             }
        }


        function handleVideoEnd() {
            console.log("Video ended. Handling next action based on repeat/shuffle.");
            stopProgressUpdater(); // Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ
            saveCurrentPosition(0); // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙƒÙ€ 0 Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ

            if (repeatMode === 'one') {
                // ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                console.log("Repeat Mode: one. Replaying current video.");
                player.seekTo(0, true);
                player.playVideo();
            } else {
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ§Ù„ÙŠ (Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙˆØ§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙ„ÙŠ)
                playNext();
            }
        }

        function playNext() {
            if (playlist.length === 0) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù„ØªØ´ØºÙŠÙ„Ù‡

            let nextIndex;

            if (isShuffleOn) {
                const shuffledIndices = getShuffledIndices();
                 // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙÙ‡Ø±Ø³ *Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ* Ø§Ù„Ø­Ø§Ù„ÙŠ
                const currentShuffledIndex = shuffledIndices.indexOf(currentVideoIndex);

                if (currentShuffledIndex === -1) { // Ø­Ø§Ù„Ø© Ù†Ø§Ø¯Ø±Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø£ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                    nextIndex = shuffledIndices[0];
                 } else if (currentShuffledIndex < shuffledIndices.length - 1) {
                    // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                     nextIndex = shuffledIndices[currentShuffledIndex + 1];
                     console.log(`Shuffle ON: Playing next shuffled video. Current shuffled index: ${currentShuffledIndex}, Next original index: ${nextIndex}`);
                } else {
                    // ÙˆØµÙ„Øª Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                    if (repeatMode === 'all') {
                        // ÙƒØ±Ø± Ø§Ù„ÙƒÙ„: Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø£ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                         nextIndex = shuffledIndices[0];
                         console.log("Shuffle ON & Repeat All ON: Reached end of shuffled list, starting from beginning.");
                    } else {
                        // Ù„Ø§ ØªÙƒØ±Ø§Ø±: ØªÙˆÙ‚Ù Ø£Ùˆ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
                        console.log("Shuffle ON & Repeat OFF: Reached end of shuffled list. Stopping.");
                         updateUIForNoVideo(); // Ø£Ùˆ Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡ Ø¢Ø®Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                        return; // Ù„Ø§ ØªØ´ØºÙ„ Ø´ÙŠØ¦Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹
                    }
                }
            } else {
                // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                if (currentVideoIndex < playlist.length - 1) {
                    // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    nextIndex = currentVideoIndex + 1;
                    console.log(`Shuffle OFF: Playing next video in order. Next index: ${nextIndex}`);
                } else {
                    // ÙˆØµÙ„Øª Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    if (repeatMode === 'all') {
                        // ÙƒØ±Ø± Ø§Ù„ÙƒÙ„: Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø£ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                        nextIndex = 0;
                         console.log("Shuffle OFF & Repeat All ON: Reached end of list, starting from beginning.");
                    } else {
                        // Ù„Ø§ ØªÙƒØ±Ø§Ø±: ØªÙˆÙ‚Ù Ø£Ùˆ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
                        console.log("Shuffle OFF & Repeat OFF: Reached end of list. Stopping.");
                         updateUIForNoVideo(); // Ø£Ùˆ Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡ Ø¢Ø®Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                        return; // Ù„Ø§ ØªØ´ØºÙ„ Ø´ÙŠØ¦Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹
                    }
                }
            }

            if (nextIndex !== undefined) {
                playVideo(nextIndex);
            }
        }

        function playPrevious() {
            if (playlist.length === 0) return;

             let prevIndex;

             // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø§Ø¨Ù‚ØŒ ÙˆØ¥Ù„Ø§ Ø£Ø¹Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
             if (player && typeof player.getCurrentTime === 'function' && player.getCurrentTime() > 3) {
                 player.seekTo(0, true);
                 console.log("Playing previous: Restarting current video.");
                 return;
             }


             if (isShuffleOn) {
                const shuffledIndices = getShuffledIndices();
                const currentShuffledIndex = shuffledIndices.indexOf(currentVideoIndex);

                if (currentShuffledIndex <= 0) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£ÙˆÙ„ Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
                     // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…ÙØ¹Ù„Ø§Ù‹) Ø£Ùˆ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
                    if (repeatMode === 'all' && shuffledIndices.length > 0) {
                         prevIndex = shuffledIndices[shuffledIndices.length - 1];
                         console.log(`Shuffle ON & Repeat All ON: Playing previous from start, going to last shuffled: ${prevIndex}`);
                     } else {
                         console.log("Shuffle ON: At start or invalid index, no previous.");
                         player.seekTo(0, true); // Ø£Ø¹Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·
                         return;
                     }
                } else {
                     prevIndex = shuffledIndices[currentShuffledIndex - 1];
                     console.log(`Shuffle ON: Playing previous shuffled video. Prev original index: ${prevIndex}`);
                }
            } else {
                // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                if (currentVideoIndex > 0) {
                    prevIndex = currentVideoIndex - 1;
                    console.log(`Shuffle OFF: Playing previous video in order. Prev index: ${prevIndex}`);
                } else {
                    // ÙˆØµÙ„Øª Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    if (repeatMode === 'all' && playlist.length > 0) {
                        // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                        prevIndex = playlist.length - 1;
                        console.log(`Shuffle OFF & Repeat All ON: Playing previous from start, going to last: ${prevIndex}`);
                    } else {
                        console.log("Shuffle OFF: At start, no previous.");
                        player.seekTo(0, true); // Ø£Ø¹Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·
                        return;
                    }
                }
            }

            if (prevIndex !== undefined) {
                playVideo(prevIndex);
            }
        }

        function togglePlayPause() {
            if (!player || !isPlayerReady) return;
            const state = player.getPlayerState();
            if (state === YT.PlayerState.PLAYING || state === YT.PlayerState.BUFFERING) {
                player.pauseVideo();
                 console.log("togglePlayPause: Pausing video.");
            } else {
                player.playVideo();
                 console.log("togglePlayPause: Playing video.");
            }
        }

        function updatePlayPauseButton() {
            if (!player || !isPlayerReady || !player.getPlayerState) {
                playPauseBtn.textContent = 'â–¶'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                playPauseBtn.title = 'ØªØ´ØºÙŠÙ„';
                playPauseBtn.disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹
                return;
            }

            const state = player.getPlayerState();
            if (state === YT.PlayerState.PLAYING) {
                playPauseBtn.textContent = 'âšâš'; // Ø±Ù…Ø² Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
                playPauseBtn.title = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª (Space/K)';
                playPauseBtn.disabled = false;
            } else if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.ENDED || state === YT.PlayerState.CUED || state === -1) {
                playPauseBtn.textContent = 'â–¶'; // Ø±Ù…Ø² Ø§Ù„ØªØ´ØºÙŠÙ„
                playPauseBtn.title = 'ØªØ´ØºÙŠÙ„ (Space/K)';
                 playPauseBtn.disabled = playlist.length === 0; // ØªØ¹Ø·ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©
            } else if (state === YT.PlayerState.BUFFERING) {
                playPauseBtn.textContent = '...'; // Ø£Ùˆ Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ­Ù…ÙŠÙ„
                playPauseBtn.title = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
                playPauseBtn.disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            }
        }

        function updateNavButtons() {
             const canGoPrev = isShuffleOn
                 ? (repeatMode === 'all' || getShuffledIndices().indexOf(currentVideoIndex) > 0)
                 : (repeatMode === 'all' || currentVideoIndex > 0);
             const canGoNext = isShuffleOn
                 ? (repeatMode === 'all' || getShuffledIndices().indexOf(currentVideoIndex) < getShuffledIndices().length - 1)
                 : (repeatMode === 'all' || currentVideoIndex < playlist.length - 1);

             prevBtn.disabled = playlist.length <= 1 || !canGoPrev;
             nextBtn.disabled = playlist.length <= 1 || !canGoNext;

             // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© ÙˆÙ„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø´ÙŠØ¡
             updatePlayPauseButton();
        }

        // -------------------------------------------------------------
        //  Progress Bar & Time Display
        // -------------------------------------------------------------

        function startProgressUpdater() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
             stopProgressUpdater();

            // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø¬Ø¯ÙŠØ¯ Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            progressUpdateInterval = setInterval(() => {
                if (player && isPlayerReady && typeof player.getCurrentTime === 'function' && typeof player.getDuration === 'function') {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    const buffered = player.getVideoLoadedFraction(); // Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„

                    if (!isNaN(duration) && duration > 0) {
                        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                        const progressPercent = (currentTime / duration) * 100;
                        progressBarFilled.style.width = `${progressPercent}%`;

                         // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ØµØºÙŠØ±Ø© (Thumb)
                         // Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¥Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø¨ÙƒØ³Ù„ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… right/left
                         progressBarThumb.style.right = `${progressPercent}%`; // Ù„Ù€ dir=rtl
                         progressBarThumb.style.opacity = '1'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù‚Ø·Ø© Ø·Ø§Ù„Ù…Ø§ ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«

                        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª
                        const bufferedPercent = buffered * 100;
                        progressBarBuffered.style.width = `${bufferedPercent}%`;

                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª
                        timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
                    } else {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯
                        timeDisplay.textContent = `${formatTime(currentTime)} / --:--`;
                        progressBarFilled.style.width = `0%`;
                        progressBarThumb.style.opacity = '0';
                        progressBarBuffered.style.width = `0%`;
                    }
                }
            }, 500); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ© (Ø£ÙƒØ«Ø± Ø³Ù„Ø§Ø³Ø©)
        }

        function stopProgressUpdater() {
            if (progressUpdateInterval) {
                clearInterval(progressUpdateInterval);
                progressUpdateInterval = null;
                 // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù‚Ø·Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆÙ‚Ù
                 //progressBarThumb.style.opacity = '0';
            }
        }

        function handleProgressClick(event) {
            if (!player || !isPlayerReady || typeof player.getDuration !== 'function') return;

            const duration = player.getDuration();
            if (isNaN(duration) || duration <= 0) return;

            const progressBarRect = progressBarContainer.getBoundingClientRect();
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ RTL: Ø§Ù„Ù†Ù‚Ø± ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†
            const clickPositionX = event.clientX;
            const progressBarStart = progressBarRect.right; // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´Ø±ÙŠØ· Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†
            const progressBarWidth = progressBarRect.width;

             // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
             let clickRatio = (progressBarStart - clickPositionX) / progressBarWidth;
             clickRatio = Math.max(0, Math.min(1, clickRatio)); // Ø¶Ù…Ø§Ù† Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨ÙŠÙ† 0 Ùˆ 1

            const seekTime = clickRatio * duration;

             console.log(`Progress bar clicked. Ratio (RTL): ${clickRatio.toFixed(3)}, Seeking to: ${formatTime(seekTime)}`);

            player.seekTo(seekTime, true); // true = allowSeekAhead

            // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¤Ù‚Øª)
            progressBarFilled.style.width = `${clickRatio * 100}%`;
            progressBarThumb.style.right = `${clickRatio * 100}%`;
            timeDisplay.textContent = `${formatTime(seekTime)} / ${formatTime(duration)}`;
             // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙ‚ÙØ§Ù‹
             if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
                 player.playVideo();
             }
        }

        function formatTime(totalSeconds) {
            if (isNaN(totalSeconds) || totalSeconds < 0) {
                return "00:00";
            }
            const seconds = Math.floor(totalSeconds % 60);
            const minutes = Math.floor((totalSeconds / 60) % 60);
            const hours = Math.floor(totalSeconds / 3600);

            const formattedSeconds = String(seconds).padStart(2, '0');
            const formattedMinutes = String(minutes).padStart(2, '0');

            if (hours > 0) {
                return `${hours}:${formattedMinutes}:${formattedSeconds}`;
            } else {
                return `${formattedMinutes}:${formattedSeconds}`;
            }
        }

        // -------------------------------------------------------------
        //  Volume Control
        // -------------------------------------------------------------

        function toggleMute() {
            if (!player || !isPlayerReady) return;
            if (player.isMuted()) {
                player.unMute();
                isMuted = false;
                 // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙƒØªÙ… Ù…Ù† Ù‚Ø¨Ù„
                 volumeSlider.value = currentVolume;
                 player.setVolume(currentVolume);
                 console.log("Unmuted. Volume set to:", currentVolume);
            } else {
                // Ø­ÙØ¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØªÙ…
                 currentVolume = player.getVolume(); // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ
                player.mute();
                isMuted = true;
                 volumeSlider.value = 0; // ÙŠÙ…ÙƒÙ† Ø¶Ø¨Ø· Ø§Ù„Ø´Ø±ÙŠØ· Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ± Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªÙ…
                 console.log("Muted. Previous volume was:", currentVolume);
            }
            updateVolumeUI();
             saveAppState(); // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªÙ… ÙˆØ§Ù„ØµÙˆØª
        }

        function setVolume(volumeLevel) {
             if (!player || !isPlayerReady) return;
             volumeLevel = Math.max(0, Math.min(100, volumeLevel)); // Ø¶Ù…Ø§Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ÙŠÙ† 0 Ùˆ 100

             player.setVolume(volumeLevel);
             currentVolume = volumeLevel; // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ

             if (volumeLevel > 0 && isMuted) {
                 player.unMute(); // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØª
                 isMuted = false;
             } else if (volumeLevel === 0 && !isMuted) {
                 player.mute(); // ÙƒØªÙ… Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ ÙˆØµÙ„ Ù„Ù„ØµÙØ±
                 isMuted = true;
             }
             console.log("Volume set to:", volumeLevel);
             updateVolumeUI();
             saveAppState(); // Ø­ÙØ¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¬Ø¯ÙŠØ¯
        }

        function updateVolumeUI() {
            if (!player || !isPlayerReady || typeof player.getVolume !== 'function') {
                 // Ø­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£Ùˆ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©
                 volumeSlider.value = currentVolume; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                 muteBtn.textContent = currentVolume > 0 ? (isMuted ? 'ğŸ”‡' : 'ğŸ”Š') : 'ğŸ”‡';
                 muteBtn.title = isMuted ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… (M)' : 'ÙƒØªÙ… (M)';
                 return;
            }

            const volume = isMuted ? 0 : player.getVolume();
             volumeSlider.value = volume;

             // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒØªÙ…
            if (isMuted || volume === 0) {
                muteBtn.textContent = 'ğŸ”‡';
                muteBtn.title = 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… (M)';
            } else if (volume > 50) {
                muteBtn.textContent = 'ğŸ”Š';
                muteBtn.title = 'ÙƒØªÙ… (M)';
            } else {
                muteBtn.textContent = 'ğŸ”‰'; // Ø£ÙŠÙ‚ÙˆÙ†Ø© ØµÙˆØª Ø£Ù‚Ù„
                muteBtn.title = 'ÙƒØªÙ… (M)';
            }

             // ØªØ­Ø¯ÙŠØ« Ø®Ù„ÙÙŠØ© Ø´Ø±ÙŠØ· Ø§Ù„ØµÙˆØª Ù„ØªØ¹ÙƒØ³ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
             const percentage = volume / 100;
             const colorStop = `linear-gradient(to left, var(--primary-color) ${percentage * 100}%, rgba(255, 255, 255, 0.3) ${percentage * 100}%)`; // RTL: Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±
             volumeSlider.style.background = colorStop;
        }

        // -------------------------------------------------------------
        //  Repeat & Shuffle
        // -------------------------------------------------------------

        function toggleRepeat() {
            const currentIndex = REPEAT_MODES.indexOf(repeatMode);
            const nextIndex = (currentIndex + 1) % REPEAT_MODES.length;
            repeatMode = REPEAT_MODES[nextIndex];

            console.log("Repeat Mode changed to:", repeatMode);
            updateRepeatButton();
             saveAppState(); // Ø­ÙØ¸ ÙˆØ¶Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
             updateNavButtons(); // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            showNotification(`ÙˆØ¶Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±: ${getRepeatModeText()}`);
        }

        function updateRepeatButton() {
            repeatBtn.textContent = REPEAT_ICONS[repeatMode] || 'ğŸ”';
            repeatBtn.title = `ØªÙƒØ±Ø§Ø±: ${getRepeatModeText()} (R)`;
             repeatBtn.classList.toggle('active', repeatMode !== 'off');
        }

        function getRepeatModeText() {
            switch (repeatMode) {
                case 'one': return 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                case 'all': return 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù‡Ø§';
                default: return 'Ø¥ÙŠÙ‚Ø§Ù';
            }
        }

        function toggleShuffle() {
            isShuffleOn = !isShuffleOn;
            console.log("Shuffle Mode changed to:", isShuffleOn);
            updateShuffleButton();
             applyShuffle(); // ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
             renderPlaylist(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
             saveAppState(); // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
             updateNavButtons(); // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            showNotification(isShuffleOn ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ');
        }

        function updateShuffleButton() {
            shuffleBtn.classList.toggle('active', isShuffleOn);
            shuffleBtn.title = `ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (${isShuffleOn ? 'Ù…ÙØ¹Ù„' : 'Ù…ØªÙˆÙ‚Ù'}) (S)`;
        }

        // Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø£Ùˆ Ø¥Ù„ØºØ§Ø¤Ù‡)
        let shuffledIndices = []; // ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø®Ù„ÙˆØ·Ø©
        function applyShuffle() {
            if (isShuffleOn) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© ÙÙ‡Ø§Ø±Ø³ Ù…Ù† 0 Ø¥Ù„Ù‰ Ø·ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© - 1
                const indices = Array.from(playlist.keys());
                 // Ø®Ù„Ø· Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Fisher-Yates algorithm
                 for (let i = indices.length - 1; i > 0; i--) {
                     const j = Math.floor(Math.random() * (i + 1));
                     [indices[i], indices[j]] = [indices[j], indices[i]]; // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                 }
                 shuffledIndices = indices;
                 console.log("Shuffled indices generated:", shuffledIndices);
            } else {
                 shuffledIndices = []; // Ù…Ø³Ø­ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø®Ù„ÙˆØ·Ø©
                 console.log("Shuffle disabled. Using original order.");
            }
            // Ù„Ø§ Ù†ØºÙŠØ± playlist Ù†ÙØ³Ù‡Ø§ØŒ ÙÙ‚Ø· Ø·Ø±ÙŠÙ‚Ø© Ø¹Ø±Ø¶Ù‡Ø§ Ø£Ùˆ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ†Ù‡Ø§
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ (Ø¹Ø§Ø¯ÙŠØ© Ø£Ùˆ Ù…Ø®Ù„ÙˆØ·Ø©)
        function getShuffledIndices() {
             // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ø®Ù„ÙˆØ·Ø© Ù…Ø­Ø¯Ù‘Ø«Ø© Ø¥Ø°Ø§ ØªØºÙŠØ± Ø·ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
             if (isShuffleOn && shuffledIndices.length !== playlist.length) {
                 applyShuffle(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ù„Ø· Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
             }
             return isShuffleOn ? shuffledIndices : Array.from(playlist.keys());
        }


        // -------------------------------------------------------------
        //  Playback Speed Control
        // -------------------------------------------------------------

        function setPlaybackSpeed(speed) {
             if (!player || !isPlayerReady || typeof player.setPlaybackRate !== 'function') return;
             speed = parseFloat(speed);
             if (isNaN(speed)) return;

             const availableSpeeds = player.getAvailablePlaybackRates ? player.getAvailablePlaybackRates() : [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]; // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
             if (availableSpeeds.includes(speed)) {
                 player.setPlaybackRate(speed);
                 currentSpeed = speed;
                 console.log("Playback speed set to:", speed);
                 updateSpeedSelector();
                 saveAppState(); // Ø­ÙØ¸ Ø§Ù„Ø³Ø±Ø¹Ø©
             } else {
                 console.warn("Requested speed", speed, "is not available.");
                 // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                 updateSpeedSelector();
             }
        }

        function updateSpeedSelector() {
            speedSelector.value = currentSpeed;
        }

        // -------------------------------------------------------------
        //  Fullscreen Control
        // -------------------------------------------------------------

        function toggleFullscreen() {
            const doc = document; // Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            const playerElement = mainContainer; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©

            if (!doc.fullscreenElement && !doc.webkitFullscreenElement && !doc.mozFullScreenElement && !doc.msFullscreenElement) {
                // Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                console.log("Entering fullscreen...");
                if (playerElement.requestFullscreen) {
                    playerElement.requestFullscreen();
                } else if (playerElement.mozRequestFullScreen) { /* Firefox */
                    playerElement.mozRequestFullScreen();
                } else if (playerElement.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                    playerElement.webkitRequestFullscreen();
                } else if (playerElement.msRequestFullscreen) { /* IE/Edge */
                    playerElement.msRequestFullscreen();
                }
                 // Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                 // if (player && player.playVideo) setTimeout(() => player.playVideo(), 100);
            } else {
                // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                console.log("Exiting fullscreen...");
                if (doc.exitFullscreen) {
                    doc.exitFullscreen();
                } else if (doc.mozCancelFullScreen) { /* Firefox */
                    doc.mozCancelFullScreen();
                } else if (doc.webkitExitFullscreen) { /* Chrome, Safari & Opera */
                    doc.webkitExitFullscreen();
                } else if (doc.msExitFullscreen) { /* IE/Edge */
                    doc.msExitFullscreen();
                }
            }
        }

        function updateFullscreenButton() {
            const doc = document;
            if (doc.fullscreenElement || doc.webkitFullscreenElement || doc.mozFullScreenElement || doc.msFullscreenElement) {
                fullscreenBtn.textContent = 'Exit â›¶'; // Ø£Ùˆ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø®Ø±ÙˆØ¬
                fullscreenBtn.title = 'Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© (F/Esc)';
            } else {
                fullscreenBtn.textContent = 'â›¶';
                fullscreenBtn.title = 'Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© (F)';
            }
        }

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠØ± Ø­Ø§Ù„Ø© Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© (Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø±)
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('mozfullscreenchange', updateFullscreenButton);
        document.addEventListener('MSFullscreenChange', updateFullscreenButton);


        // -------------------------------------------------------------
        //  Playback Position Memory
        // -------------------------------------------------------------

        function saveCurrentPosition(time = null) {
             if (!player || !isPlayerReady || typeof player.getCurrentTime !== 'function' || currentVideoIndex === -1) return;

             const currentVideo = playlist[currentVideoIndex];
             if (!currentVideo) return;

             const position = (time !== null) ? time : player.getCurrentTime();
             if (!isNaN(position) && position >= 0) {
                lastSavedPosition[currentVideo.id] = position.toFixed(2); // Ø­ÙØ¸ Ù„Ù€ 2 Ø®Ø§Ù†Ø© Ø¹Ø´Ø±ÙŠØ©
                 // ÙŠÙ…ÙƒÙ† Ø­ÙØ¸Ù‡Ø§ ÙÙŠ localStorage Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ø£Ù‚Ù„ ØªÙƒØ±Ø§Ø±Ø§Ù‹ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
                 // throttleSavePosition(); // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­ÙØ¸
             }
        }

        function loadSavedPositions() {
            const saved = localStorage.getItem('youtubeLastPositions');
            if (saved) {
                lastSavedPosition = JSON.parse(saved);
                console.log("Loaded last saved positions for videos.");
            } else {
                lastSavedPosition = {};
            }
        }

        function savePositionsToStorage() {
            // Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
            localStorage.setItem('youtubeLastPositions', JSON.stringify(lastSavedPosition));
            console.log("Saved video positions to localStorage.");
        }

         // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ ØªØ­Ø¯ÙŠØ«Ù‡Ø§
         window.addEventListener('beforeunload', () => {
             saveCurrentPosition(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø®ÙŠØ±
             savePositionsToStorage();
         });


        // -------------------------------------------------------------
        //  State Management (Load/Save App State)
        // -------------------------------------------------------------

        function saveAppState() {
            const state = {
                currentVideoIndex: currentVideoIndex,
                volume: currentVolume,
                isMuted: isMuted,
                repeatMode: repeatMode,
                isShuffleOn: isShuffleOn,
                playbackRate: currentSpeed
                // Ù„Ø§ Ù†Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù‡Ù†Ø§ØŒ Ù„Ù‡Ø§ Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ© Ø¨Ù‡Ø§ savePlaylist()
                 // Ù„Ø§ Ù†Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ù‡Ù†Ø§ØŒ Ù„Ù‡Ø§ Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ© Ø¨Ù‡Ø§ savePositionsToStorage()
            };
            localStorage.setItem('youtubeAppState', JSON.stringify(state));
            console.log("App state saved:", state);

             // Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ø£ÙŠØ¶Ø§Ù‹ (ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬Ù‡Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª)
             savePlaylist();
             savePositionsToStorage();
        }

        function loadAppState() {
             loadPlaylist(); // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
             loadSavedPositions(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©

            const savedState = localStorage.getItem('youtubeAppState');
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    console.log("Loading app state:", state);

                     // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØªÙ‡)
                     if (state.currentVideoIndex !== undefined && state.currentVideoIndex >= 0 && state.currentVideoIndex < playlist.length) {
                        currentVideoIndex = state.currentVideoIndex;
                     } else if (playlist.length > 0) {
                        currentVideoIndex = 0; // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙ‡Ø±Ø³ ØºÙŠØ± ØµØ§Ù„Ø­ØŒ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„
                     } else {
                        currentVideoIndex = -1; // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©
                     }

                    currentVolume = state.volume !== undefined ? state.volume : 100;
                    isMuted = state.isMuted !== undefined ? state.isMuted : false;
                    repeatMode = REPEAT_MODES.includes(state.repeatMode) ? state.repeatMode : 'off';
                    isShuffleOn = state.isShuffleOn !== undefined ? state.isShuffleOn : false;
                    currentSpeed = state.playbackRate !== undefined ? state.playbackRate : 1;

                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹
                    if (isShuffleOn) {
                        applyShuffle();
                        renderPlaylist(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                    }

                     console.log("App state loaded successfully.");
                } catch (e) {
                     console.error("Error loading app state from localStorage:", e);
                     // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£
                     resetToDefaults();
                }
            } else {
                console.log("No saved app state found. Using defaults.");
                 // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ù‚Ø§Ø¦Ù…Ø© ØªØ´ØºÙŠÙ„ ÙˆÙ„Ù… ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„Ø© Ù…Ø­ÙÙˆØ¸Ø©
                 if (playlist.length > 0) currentVideoIndex = 0;
                resetToDefaults(); // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ØªØ¹ÙƒØ³ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø©
            updateUIFromState();
        }

        function resetToDefaults() {
             // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø¥Ù„Ù‰ Ù‚ÙŠÙ…Ù‡Ø§ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            // currentVideoIndex ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙÙŠ loadAppState
             currentVolume = 100;
             isMuted = false;
             repeatMode = 'off';
             isShuffleOn = false;
             currentSpeed = 1;
        }

        function updateUIFromState() {
             updateVolumeUI();
             updateRepeatButton();
             updateShuffleButton();
             updateSpeedSelector();
             renderPlaylist(); // Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨
             updateNavButtons();
        }

        function applyInitialSettings() {
             if (!player || !isPlayerReady) return;
             console.log("Applying initial player settings...");
             // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙˆØª
             if (isMuted) {
                 player.mute();
             } else {
                 player.unMute();
                 player.setVolume(currentVolume);
             }
             // ØªØ·Ø¨ÙŠÙ‚ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
             setPlaybackSpeed(currentSpeed); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„ØªÙ†Ø§ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ­Ù‚Ù‚
             updateVolumeUI(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        }


        // -------------------------------------------------------------
        //  Notifications
        // -------------------------------------------------------------
        let notificationTimeout;
        function showNotification(message) {
            if (notificationTimeout) clearTimeout(notificationTimeout); // Ù…Ø³Ø­ Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…
            notification.textContent = message;
            notification.classList.add('show');

            notificationTimeout = setTimeout(() => {
                notification.classList.remove('show');
                notificationTimeout = null;
            }, 3000); // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
        }

        // -------------------------------------------------------------
        //  Wake Lock (Keep Screen On)
        // -------------------------------------------------------------
        let wakeLock = null;
        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        console.log('Screen Wake Lock released:', wakeLock.released);
                        // Ù‚Ø¯ ØªØ±ØºØ¨ ÙÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ø·Ù„Ø§Ù‚Ù‡ Ø¹Ù…Ø¯Ù‹Ø§
                    });
                    console.log('Screen Wake Lock is active.');
                    showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©.');
                } catch (err) {
                    console.error(`Wake Lock error: ${err.name}, ${err.message}`);
                    wakeLock = null;
                     // Ù„Ø§ ØªØ¸Ù‡Ø± Ø¥Ø´Ø¹Ø§Ø± Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙ‚Ø·
                }
            } else {
                console.warn('Wake Lock API not supported.');
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ù‚ÙÙ„ Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø±Ø¤ÙŠØ© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                console.log("Document became visible, attempting to re-acquire wake lock.");
                await requestWakeLock();
            }
        });

        // -------------------------------------------------------------
        //  Keyboard Shortcuts
        // -------------------------------------------------------------
        function handleKeyPress(e) {
             // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
             if (document.activeElement === videoUrlInput) {
                 // Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù€ Enter Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                 if (e.key === 'Enter') {
                     addToPlaylistBtn.click(); // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                 }
                 return;
             }

             console.log("Key pressed:", e.key, "Shift:", e.shiftKey);

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… e.key ÙŠÙˆÙØ± ØªÙˆØ§ÙÙ‚ÙŠØ© Ø£ÙØ¶Ù„ Ù…Ù† keyCode
            switch (e.key.toUpperCase()) { // ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø­Ø±Ù Ø§Ù„ÙƒØ¨ÙŠØ± Ù„ØªØ¬Ø§Ù‡Ù„ Ø­Ø§Ù„Ø© Shift Ù„Ù„Ø­Ø±ÙˆÙ
                case ' ': // Spacebar
                case 'K': // K (common shortcut)
                    e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø§Ù„Ù€ Space
                    togglePlayPause();
                    break;
                case 'M': // M for Mute
                    e.preventDefault();
                    toggleMute();
                    break;
                case 'F': // F for Fullscreen
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'R': // R for Repeat
                    e.preventDefault();
                    toggleRepeat();
                    break;
                case 'S': // S for Shuffle
                     e.preventDefault();
                     toggleShuffle();
                     break;
                case 'P': // P for Previous (with Shift)
                    if (e.shiftKey) {
                        e.preventDefault();
                        playPrevious();
                    }
                    break;
                case 'N': // N for Next (with Shift)
                    if (e.shiftKey) {
                        e.preventDefault();
                        playNext();
                    }
                    break;
                 // --- Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø« (Seek) ---
                 case 'ARROWLEFT': // Left Arrow - Seek Backward 5s
                      e.preventDefault();
                      seekRelative(-5);
                      break;
                 case 'ARROWRIGHT': // Right Arrow - Seek Forward 5s
                      e.preventDefault();
                      seekRelative(5);
                      break;
                 case 'J': // J - Seek Backward 10s
                      e.preventDefault();
                      seekRelative(-10);
                      break;
                 case 'L': // L - Seek Forward 10s
                      e.preventDefault();
                      seekRelative(10);
                      break;
                 // --- Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ù†Ø³Ø¨ÙŠ ---
                 case '0': case '1': case '2': case '3': case '4':
                 case '5': case '6': case '7': case '8': case '9':
                      e.preventDefault();
                      seekToPercentage(parseInt(e.key) * 10);
                      break;
                 // --- Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª ---
                 case 'ARROWUP': // Up Arrow - Volume Up
                      e.preventDefault();
                      adjustVolume(5); // Ø²ÙŠØ§Ø¯Ø© 5%
                      break;
                 case 'ARROWDOWN': // Down Arrow - Volume Down
                      e.preventDefault();
                      adjustVolume(-5); // ØªÙ‚Ù„ÙŠÙ„ 5%
                      break;

                 // --- Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ---
                 /*
                 case 'I': // I for PIP (Picture-in-Picture)
                     e.preventDefault();
                     togglePictureInPicture();
                     break;
                 case '<': // < (Shift + ,) - Decrease Speed
                     if (e.shiftKey) {
                         e.preventDefault();
                         changeSpeed(-1); // Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø¨Ø·Ø£ Ø§Ù„ØªØ§Ù„ÙŠØ©
                     }
                     break;
                 case '>': // > (Shift + .) - Increase Speed
                     if (e.shiftKey) {
                         e.preventDefault();
                         changeSpeed(1); // Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ø±Ø¹ Ø§Ù„ØªØ§Ù„ÙŠØ©
                     }
                     break;
                 */
                 case 'ESCAPE': // Escape - Exit Fullscreen
                      // Ø§Ù„Ù…ØªØµÙØ­ ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ Ø¹Ø§Ø¯Ø©Ù‹ Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¥Ø¶Ø§ÙÙŠ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                      break;

            }
        }

         function seekRelative(seconds) {
            if (!player || !isPlayerReady || typeof player.getCurrentTime !== 'function' || typeof player.seekTo !== 'function') return;
            const currentTime = player.getCurrentTime();
            const newTime = Math.max(0, currentTime + seconds); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ÙˆÙ‚Øª Ø³Ø§Ù„Ø¨
            player.seekTo(newTime, true);
            showNotification(`${seconds > 0 ? '+' : ''}${seconds} Ø«ÙˆØ§Ù†ÙŠ`);
             // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
             updateProgressFromTime(newTime);
         }

         function seekToPercentage(percentage) {
            if (!player || !isPlayerReady || typeof player.getDuration !== 'function' || typeof player.seekTo !== 'function') return;
            const duration = player.getDuration();
            if (isNaN(duration) || duration <= 0) return;
            const newTime = (percentage / 100) * duration;
            player.seekTo(newTime, true);
            showNotification(`Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ${percentage}%`);
             // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
             updateProgressFromTime(newTime);
         }

         function adjustVolume(delta) {
             if (!player || !isPlayerReady || typeof player.getVolume !== 'function') return;
             let newVolume = player.getVolume() + delta;
             newVolume = Math.max(0, Math.min(100, newVolume)); // Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ 0-100
             setVolume(newVolume); // Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„ØªÙ†Ø§ Ù„Ù„Ø¶Ø¨Ø· ÙˆØ§Ù„Ø­ÙØ¸
             showNotification(`Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª: ${Math.round(newVolume)}%`);
         }

         // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«
         function updateProgressFromTime(time) {
             if (!player || typeof player.getDuration !== 'function') return;
             const duration = player.getDuration();
             if (isNaN(duration) || duration <= 0) return;
             const progressPercent = (time / duration) * 100;
             progressBarFilled.style.width = `${progressPercent}%`;
             progressBarThumb.style.right = `${progressPercent}%`;
             timeDisplay.textContent = `${formatTime(time)} / ${formatTime(duration)}`;
         }


        // -------------------------------------------------------------
        //  Initialization & Event Listeners
        // -------------------------------------------------------------
        const mainContainer = document.querySelector('.main-container'); // ØªØ¹Ø±ÙŠÙ Ù„Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©

        function init() {
            console.log("Initializing Application...");
            loadYouTubeAPI(); // Ø·Ù„Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ API Ø£ÙˆÙ„Ø§Ù‹
            // loadAppState() Ø³ØªÙØ³ØªØ¯Ø¹Ù‰ Ø§Ù„Ø¢Ù† Ù…Ù† Ø¯Ø§Ø®Ù„ onYouTubeIframeAPIReady

            // -- Event Listeners --
            // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            addToPlaylistBtn.addEventListener('click', () => {
                const url = videoUrlInput.value.trim();
                if (url) {
                    addToPlaylist(url);
                } else {
                    showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù…Ø¹Ø±Ù ÙÙŠØ¯ÙŠÙˆ');
                    videoUrlInput.focus();
                }
            });

             // Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
             // (ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø¯Ø§Ø®Ù„ handleKeyPress)

             // Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
             playPauseBtn.addEventListener('click', togglePlayPause);

             // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚
             prevBtn.addEventListener('click', playPrevious);
             nextBtn.addEventListener('click', playNext);

             // Ø²Ø± ÙƒØªÙ… Ø§Ù„ØµÙˆØª ÙˆØ´Ø±ÙŠØ· ØªÙ…Ø±ÙŠØ± Ø§Ù„ØµÙˆØª
             muteBtn.addEventListener('click', toggleMute);
             volumeSlider.addEventListener('input', (e) => {
                setVolume(parseInt(e.target.value));
             });

             // Ø²Ø± Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
             repeatBtn.addEventListener('click', toggleRepeat);
             shuffleBtn.addEventListener('click', toggleShuffle);

             // Ù…Ø­Ø¯Ø¯ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
             speedSelector.addEventListener('change', (e) => {
                setPlaybackSpeed(e.target.value);
             });

             // Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
             fullscreenBtn.addEventListener('click', toggleFullscreen);

             // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù„Ø¨Ø­Ø«
             progressBarContainer.addEventListener('click', handleProgressClick);

             // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
             document.addEventListener('keydown', handleKeyPress);

             // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
             // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ø£Ùˆ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø®Ø§Øµ
             requestWakeLock();

            console.log("Event listeners attached.");
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>